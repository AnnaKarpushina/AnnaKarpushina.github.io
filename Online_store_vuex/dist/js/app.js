(function(){"use strict";var t={3040:function(t,e,n){var o=n(9242),r=n(3396),c=n(7139);const a={class:"container"},s={class:"row align-items-center mt-4 mt-md-5"},i=(0,r._)("div",{class:"col-12 col-md-9"},[(0,r._)("h1",null,"Интернет-магазин")],-1),l={class:"col-12 col-md-3"},u={class:"alert alert-default px-0 mb-0 py-1 py-md-3"},d={class:"text-nowrap"},m={class:"text-nowrap"},p=(0,r._)("hr",null,null,-1),h={class:"container"},v={class:"row"},f={class:"col-12 col-md-3 menu mb-4 mb-md-0"},_={class:"list-group"},b={class:"col-12 col-md-9"};function w(t,e,n,o,w,g){const k=(0,r.up)("router-link"),y=(0,r.up)("router-view");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("header",null,[(0,r._)("div",a,[(0,r._)("div",s,[i,(0,r._)("div",l,[(0,r._)("div",u,[(0,r._)("div",d,"В корзине: "+(0,c.zw)(t.$store.getters["cart/length"])+" шт",1),(0,r._)("div",m,"Общая сумма: "+(0,c.zw)(t.$store.getters["cart/total"])+" ₽",1)])])]),p])]),(0,r._)("section",null,[(0,r._)("div",h,[(0,r._)("div",v,[(0,r._)("div",f,[(0,r._)("ul",_,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.menu,(t=>((0,r.wg)(),(0,r.iD)("li",{class:"list-group-item",key:t.route},[(0,r.Wm)(k,{to:{name:t.route},"exact-active-class":"text-danger",onClick:e=>g.handleLink(t.route),class:(0,c.C_)({disabled:g.MenuDisabled(t.route)})},{default:(0,r.w5)((()=>[(0,r.Uk)((0,c.zw)(t.text),1)])),_:2},1032,["to","onClick","class"])])))),128))])]),(0,r._)("div",b,[(0,r.Wm)(y)])])])])])}var g={data:()=>({menu:[{route:"catalog",text:"Каталог"},{route:"cart",text:"Корзина"},{route:"checkout",text:"Заказать"}]}),methods:{handleLink(t){this.MenuDisabled(t)&&this.$router.replace(this.$route.fullPath)},MenuDisabled(t){return"checkout"===t&&0===this.$store.getters["cart/length"]}}},k=n(89);const y=(0,k.Z)(g,[["render",w]]);var C=y,D=n(65),x={namespaced:!0,state:{items:[]},getters:{all:t=>t.items,one:t=>e=>t.items.find((t=>t.id===e))},mutations:{setItems(t,e){t.items=e}},actions:{async load({commit:t}){let e=await fetch("http://faceprog.ru/reactcourseapi/products/all.php");t("setItems",await e.json())}}};n(560);const $="http://faceprog.ru/reactcourseapi/cart/";var O={namespaced:!0,state:{items:[],token:null},getters:{inCart:t=>e=>t.items.some((t=>t.id==e)),itemsDetailed:(t,e,n,o)=>t.items.map((t=>{let e=o["products/one"](t.id);return{...e,cnt:t.cnt}})),length:t=>t.items.length,total:(t,e)=>e.itemsDetailed.reduce(((t,e)=>t+e.price*e.cnt),0)},mutations:{load(t,{cart:e,token:n}){t.items=e,t.token=n},add(t,e){t.items.push({id:e,cnt:1})},remove(t,e){t.items=t.items.filter((t=>t.id!=e))},setCount(t,{id:e,cnt:n}){t.items.find((t=>t.id==e)).cnt=n}},actions:{async load({commit:t}){let e=localStorage.getItem("CART__TOKEN"),n=await fetch(`${$}load.php?token=${e}`),{cart:o,token:r,needUpdate:c}=await n.json();c&&localStorage.setItem("CART__TOKEN",r),t("load",{cart:o,token:r})},async add({commit:t,getters:e,state:n},o){if(!e.inCart(o)){let e=await fetch(`${$}add.php?token=${n.token}&id=${o}`);await e.json()&&t("add",o)}},async remove({commit:t,getters:e,state:n},o){if(e.inCart(o)){let e=await fetch(`${$}remove.php?token=${n.token}&id=${o}`);await e.json()&&t("remove",o)}},setCount({commit:t,getters:e},{id:n,cnt:o}){if(e.inCart(n)){let r=Math.min(Math.max(o,1),e.itemsDetailed.find((t=>t.id==n)).rest);t("setCount",{id:n,cnt:r})}}}};const j={modules:{products:x,cart:O},strict:!1};var z=(0,D.MT)(j),U=n(2483);const W=(0,r._)("h1",null,"Каталог всех товаров",-1),I={class:"row"},M={class:"card"},T={class:"card-body"},P=["onClick"],S=["onClick"];function Z(t,e,n,o,a,s){const i=(0,r.up)("router-link");return(0,r.wg)(),(0,r.iD)("div",null,[W,(0,r._)("div",I,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.productList,(e=>((0,r.wg)(),(0,r.iD)("div",{class:"col-12 col-sm-6 col-lg-4 mb-3 mt-3",key:e.id},[(0,r._)("div",M,[(0,r._)("div",T,[(0,r._)("h3",null,(0,c.zw)(e.title),1),(0,r._)("div",null,(0,c.zw)(e.price)+" ₽",1),(0,r._)("p",null,[(0,r.Wm)(i,{to:{name:"product",params:{id:e.id}}},{default:(0,r.w5)((()=>[(0,r.Uk)("Читать о товаре")])),_:2},1032,["to"])]),t.inCart(e.id)?((0,r.wg)(),(0,r.iD)("button",{key:0,onClick:n=>t.remove(e.id),type:"button",class:"btn btn-danger"}," Удалить из корзины ",8,P)):((0,r.wg)(),(0,r.iD)("button",{key:1,onClick:n=>t.add(e.id),type:"button",class:"btn btn-success"}," Добавить в корзину ",8,S))])])])))),128))])])}var K={computed:{...(0,D.Se)("products",{productList:"all"}),...(0,D.Se)("cart",["inCart"])},methods:{...(0,D.nv)("cart",["add","remove"])}};const E=(0,k.Z)(K,[["render",Z]]);var L=E;const A={key:0},H={class:"alert alert-success"};function Y(t,e,n,o,a,s){const i=(0,r.up)("router-link"),l=(0,r.up)("app-e-404");return s.hasProduct?((0,r.wg)(),(0,r.iD)("div",A,[(0,r._)("h1",null,(0,c.zw)(s.product.title),1),(0,r._)("div",H," Цена: "+(0,c.zw)(s.product.price)+" ₽ ",1),(0,r.Wm)(i,{to:{name:"catalog"},class:"btn btn-success"},{default:(0,r.w5)((()=>[(0,r.Uk)("Вернуться к товарам")])),_:1})])):((0,r.wg)(),(0,r.j4)(l,{key:1}))}const B=(0,r._)("h1",null,"Страница не найдена",-1),N=(0,r._)("hr",null,null,-1);function R(t,e){const n=(0,r.up)("router-link");return(0,r.wg)(),(0,r.iD)("div",null,[B,N,(0,r.Wm)(n,{to:{name:"catalog"},class:"btn btn-success"},{default:(0,r.w5)((()=>[(0,r.Uk)("Начать с главной страницы")])),_:1})])}const F={},q=(0,k.Z)(F,[["render",R]]);var G=q,J={components:{AppE404:G},computed:{...(0,D.Se)("products",{productById:"one"}),id(){return parseInt(this.$route.params.id)},product(){return this.productById(this.id)},hasProduct(){return/^[1-9]+\d*$/.test(this.id)&&void 0!==this.product}}};const Q=(0,k.Z)(J,[["render",Y]]);var V=Q;const X=(0,r._)("h1",{class:"mb-3"},"Корзина",-1),tt={key:0},et={class:"table table-bordered table-hover"},nt=(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"Название товара"),(0,r._)("th",null,"Цена"),(0,r._)("th",null,"Кол-во"),(0,r._)("th",null,"Общая цена"),(0,r._)("th",null,"Действия")])],-1),ot=["onClick","disabled"],rt=["onClick"],ct=["onClick"],at={class:"d-flex justify-content-between"},st={key:1},it=(0,r._)("div",{class:"alert alert-success"},"Корзина пуста",-1);function lt(t,e,n,o,a,s){const i=(0,r.up)("router-link");return(0,r.wg)(),(0,r.iD)("div",null,[X,t.products.length>0?((0,r.wg)(),(0,r.iD)("div",tt,[(0,r._)("table",et,[nt,(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.products,(e=>((0,r.wg)(),(0,r.iD)("tr",{key:e.id},[(0,r._)("td",null,[(0,r.Wm)(i,{to:{name:"product",params:{id:e.id}}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,c.zw)(e.title.trim()),1)])),_:2},1032,["to"])]),(0,r._)("td",null,(0,c.zw)(e.price),1),(0,r._)("td",null,(0,c.zw)(e.cnt),1),(0,r._)("td",null,(0,c.zw)(e.price*e.cnt),1),(0,r._)("td",null,[(0,r._)("button",{class:"btn btn-secondary me-2 mb-1 mb-md-0",onClick:n=>t.setCount({id:e.id,cnt:e.cnt-1}),disabled:e.cnt<=1},"-",8,ot),(0,r._)("button",{class:"btn btn-success me-2 mb-1 mb-md-0",onClick:n=>t.setCount({id:e.id,cnt:e.cnt+1})},"+",8,rt),(0,r._)("button",{class:"btn btn-danger",onClick:n=>t.remove(e.id)},"х",8,ct)])])))),128))])]),(0,r._)("div",at,[(0,r.Wm)(i,{to:{name:"checkout"},class:"btn btn-success"},{default:(0,r.w5)((()=>[(0,r.Uk)("Заказать сейчас")])),_:1})])])):((0,r.wg)(),(0,r.iD)("div",st,[it,(0,r.Wm)(i,{to:{name:"catalog"},class:"btn btn-success"},{default:(0,r.w5)((()=>[(0,r.Uk)("Вернуться к товарам")])),_:1})]))])}var ut={computed:{...(0,D.Se)("cart",{products:"itemsDetailed"})},methods:{...(0,D.nv)("cart",["setCount","remove"])}};const dt=(0,k.Z)(ut,[["render",lt]]);var mt=dt;const pt=(0,r._)("h1",{class:"mb-3"},"Заказать сейчас",-1),ht=(0,r._)("div",{class:"alert alert-success"}," Страница находится в разработке ",-1),vt=[pt,ht];function ft(t,e){return(0,r.wg)(),(0,r.iD)("div",null,vt)}const _t={},bt=(0,k.Z)(_t,[["render",ft]]);var wt=bt;const gt=[{name:"catalog",path:"/",component:L},{name:"cart",path:"/cart",component:mt},{name:"checkout",path:"/order",component:wt},{name:"product",path:"/product/:id",component:V},{path:"/:any(.*)",component:G}];var kt=(0,U.p7)({routes:gt,history:(0,U.PO)()});z.dispatch("products/load").then((()=>{(0,o.ri)(C).use(z).use(kt).mount("#app")})),z.dispatch("cart/load")}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var c=e[o]={exports:{}};return t[o].call(c.exports,c,c.exports,n),c.exports}n.m=t,function(){var t=[];n.O=function(e,o,r,c){if(!o){var a=1/0;for(u=0;u<t.length;u++){o=t[u][0],r=t[u][1],c=t[u][2];for(var s=!0,i=0;i<o.length;i++)(!1&c||a>=c)&&Object.keys(n.O).every((function(t){return n.O[t](o[i])}))?o.splice(i--,1):(s=!1,c<a&&(a=c));if(s){t.splice(u--,1);var l=r();void 0!==l&&(e=l)}}return e}c=c||0;for(var u=t.length;u>0&&t[u-1][2]>c;u--)t[u]=t[u-1];t[u]=[o,r,c]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,o){var r,c,a=o[0],s=o[1],i=o[2],l=0;if(a.some((function(e){return 0!==t[e]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(i)var u=i(n)}for(e&&e(o);l<a.length;l++)c=a[l],n.o(t,c)&&t[c]&&t[c][0](),t[c]=0;return n.O(u)},o=self["webpackChunkvue_2022_03"]=self["webpackChunkvue_2022_03"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(3040)}));o=n.O(o)})();
//# sourceMappingURL=app.js.map